# ============================================================
# JUJU DRIFT - SERVER ENVIRONMENT VARIABLES
# ============================================================
# IMPORTANTE: Copie este arquivo para .env e configure valores reais
# NUNCA comite o arquivo .env no git (j√° est√° no .gitignore)
# ============================================================

# ------------------------------------------------------------
# SERVER CONFIGURATION
# ------------------------------------------------------------
PORT=2567
NODE_ENV=development  # production | development | test

# Comma-separated list of trusted frontend origins for CORS
FRONTEND_URL=http://localhost:5173,http://driftcash.com,https://driftcash.com,http://admin.driftcash.com,https://admin.driftcash.com

# Public API base URL (usado em emails, webhooks, etc.)
API_BASE_URL=http://driftcash.com/api

# Hostnames permitidos para autentica√ß√£o admin/player
ADMIN_PANEL_HOSTS=admin.driftcash.com
CLIENT_APP_HOSTS=driftcash.com,www.driftcash.com

# ------------------------------------------------------------
# DATABASE (PostgreSQL) - MIGRADO DE SQLITE
# ------------------------------------------------------------
# Formato: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=SCHEMA
# Exemplo Local: postgresql://postgres:postgres@localhost:5432/juju_drift
# Exemplo Produ√ß√£o: postgresql://user:pass@db.provider.com:5432/juju_drift?sslmode=require

DATABASE_URL=postgresql://postgres:dev_password@localhost:5432/juju_drift?schema=public

# Pool de conex√µes (otimizar para carga esperada)
DB_POOL_SIZE=10               # N√∫mero m√°ximo de conex√µes simult√¢neas
DB_CONNECT_TIMEOUT=5000       # Timeout de conex√£o em ms (5s)
DB_POOL_TIMEOUT=10000         # Timeout de aquisi√ß√£o de conex√£o do pool (10s)

# Migrations
# Em produ√ß√£o: npx prisma migrate deploy
# Em dev: npx prisma migrate dev --name <nome>
AUTO_MIGRATE=false            # true para rodar migrations no startup (N√ÉO recomendado em prod)

# ------------------------------------------------------------
# AUTHENTICATION & SECURITY
# ------------------------------------------------------------
# üî¥ CR√çTICO: Gere um secret forte e √∫nico para PRODU√á√ÉO!
#
# Comandos para gerar:
#   openssl rand -base64 64
#   node -e "console.log(require('crypto').randomBytes(64).toString('base64'))"
#
# ‚ö†Ô∏è  O servidor RECUSAR√Å iniciar se usar valores default em produ√ß√£o:
#     - "changeme", "secret", "default", "CHANGE_THIS", etc.
#
JWT_SECRET=CHANGE_THIS_IN_PRODUCTION_USE_OPENSSL_RAND_BASE64_64

JWT_EXPIRES_IN=4h             # Dura√ß√£o do token (4h, 1d, 7d, etc)
JWT_COOKIE_MAX_AGE=14400      # Dura√ß√£o do cookie em SEGUNDOS (4h = 14400s)
AUTH_COOKIE_NAME=authToken    # Nome do cookie de autentica√ß√£o
DISABLE_AUTH_COOKIE=false     # true para desabilitar cookies (usar apenas Authorization header)

# Bcrypt salt rounds (10-12 recomendado, quanto maior = mais seguro mas mais lento)
BCRYPT_SALT_ROUNDS=10

# ------------------------------------------------------------
# FILE UPLOAD (AVATARES)
# ------------------------------------------------------------
# Provider: LOCAL | S3 | CLOUDINARY
UPLOAD_PROVIDER=LOCAL

# --- AWS S3 Configuration ---
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your_access_key_id
AWS_SECRET_ACCESS_KEY=your_secret_access_key
AWS_S3_BUCKET=juju-drift-avatars
AWS_S3_AVATAR_PREFIX=avatars/           # Prefixo dentro do bucket
AWS_CLOUDFRONT_URL=https://cdn.example.com  # Opcional: URL do CloudFront

# --- Cloudinary Configuration ---
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret
CLOUDINARY_UPLOAD_PRESET=drift_avatars  # Preset configurado no dashboard

# --- Upload Limits ---
MAX_AVATAR_SIZE_MB=5                    # Tamanho m√°ximo do arquivo (MB)
ALLOWED_AVATAR_TYPES=image/png,image/jpeg,image/jpg,image/webp  # MIME types permitidos

# ------------------------------------------------------------
# PAYMENT GATEWAY (PIX)
# ------------------------------------------------------------
# Provider: MERCADOPAGO | PAGSEGURO | ASAAS | CUSTOM
PAYMENT_PROVIDER=MERCADOPAGO

# --- Mercado Pago ---
MP_ACCESS_TOKEN=your_mercadopago_access_token
MP_PUBLIC_KEY=your_mercadopago_public_key
MP_WEBHOOK_SECRET=your_webhook_secret

# --- PagSeguro ---
PAGSEGURO_EMAIL=your_email@example.com
PAGSEGURO_TOKEN=your_pagseguro_token

# --- Asaas ---
ASAAS_API_KEY=your_asaas_api_key
ASAAS_WALLET_ID=your_wallet_id

# ------------------------------------------------------------
# AFFILIATE SYSTEM
# ------------------------------------------------------------
AFFILIATE_ENABLED=true
AFFILIATE_COMMISSION_LEVEL_1=5.0        # Comiss√£o n√≠vel 1 (%)
AFFILIATE_COMMISSION_LEVEL_2=3.0        # Comiss√£o n√≠vel 2 (%)
AFFILIATE_COMMISSION_LEVEL_3=1.0        # Comiss√£o n√≠vel 3 (%)

# ------------------------------------------------------------
# RATE LIMITING
# ------------------------------------------------------------
# Limites por IP em janela de tempo (prevenir brute-force e DoS)
RATE_LIMIT_WINDOW_MS=900000             # Janela de 15 minutos (ms)
RATE_LIMIT_MAX_REQUESTS=100             # M√°ximo 100 requests por janela
RATE_LIMIT_AUTH_MAX=20                  # M√°ximo 20 tentativas de login por janela

# WebSocket rate limiting (mensagens por segundo por cliente)
WS_MAX_MESSAGES_PER_SECOND=60

# ------------------------------------------------------------
# LOGGING
# ------------------------------------------------------------
# N√≠vel de log: error | warn | info | debug
LOG_LEVEL=info

# Arquivo de log (deixe vazio para desabilitar file logging)
LOG_FILE=logs/server.log

# Log de queries SQL (apenas em desenvolvimento)
LOG_SQL_QUERIES=false

# ------------------------------------------------------------
# EMAIL NOTIFICATIONS (OPCIONAL)
# ------------------------------------------------------------
EMAIL_ENABLED=false
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false                       # true para porta 465, false para 587
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_app_password
EMAIL_FROM=noreply@driftcash.com

# ------------------------------------------------------------
# MONITORING & OBSERVABILITY (OPCIONAL)
# ------------------------------------------------------------
# Sentry for error tracking
SENTRY_DSN=https://your_sentry_dsn@sentry.io/project_id
SENTRY_ENVIRONMENT=development

# Prometheus metrics endpoint
ENABLE_METRICS=false
METRICS_PORT=9090

# ------------------------------------------------------------
# DEVELOPMENT ONLY
# ------------------------------------------------------------
# Habilitar CORS para qualquer origem (APENAS EM DEV!)
DEV_ALLOW_ANY_ORIGIN=false

# Seed database com dados de teste no startup
DEV_AUTO_SEED=true

# Mostrar stack traces completos em erros
DEV_SHOW_STACK_TRACES=true

# ------------------------------------------------------------
# DOCKER & DEPLOYMENT
# ------------------------------------------------------------
# PostgreSQL via Docker Compose (exemplo):
# docker run --name juju-postgres \
#   -e POSTGRES_PASSWORD=dev_password \
#   -e POSTGRES_DB=juju_drift \
#   -p 5432:5432 \
#   -v juju_db_data:/var/lib/postgresql/data \
#   -d postgres:15-alpine

# Redis para cache/sessions (futuro):
# REDIS_URL=redis://localhost:6379

# ------------------------------------------------------------
# CHECKLIST DE SEGURAN√áA ANTES DE DEPLOY
# ------------------------------------------------------------
# ‚úÖ JWT_SECRET gerado com openssl rand -base64 64
# ‚úÖ DATABASE_URL com credenciais seguras (n√£o "postgres:postgres")
# ‚úÖ NODE_ENV=production
# ‚úÖ AWS/Cloudinary credentials configuradas (se usar upload externo)
# ‚úÖ FRONTEND_URL configurado apenas com dom√≠nios reais
# ‚úÖ RATE_LIMIT ativado e configurado
# ‚úÖ SSL/TLS habilitado no PostgreSQL (?sslmode=require)
# ‚úÖ Firewall configurado para bloquear acesso direto ao DB
# ‚úÖ Backups autom√°ticos do PostgreSQL configurados
# ‚úÖ Vari√°veis sens√≠veis NUNCA commitadas no git
# ------------------------------------------------------------
